<style>
  :host {
    --primary: #FF80AB;
    --primary-dark: #FF4081;
    --accent: #F48FB1;
    --success: #81C784;
    --warning: #FFB74D;
    --danger: #E57373;
    --gray-900: #212121;
    --gray-700: #616161;
    --gray-400: #BDBDBD;
    --gray-100: #FCE4EC;
    
    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      Helvetica, Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    background: linear-gradient(135deg, rgba(255,128,171,0.1) 0%, rgba(255,128,171,0.05) 100%);
  }

  .main {
    width: 100%;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1.5rem;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100" fill-opacity="0.05"><circle cx="50" cy="50" r="30" fill="%23FF80AB"/></svg>') center/400px repeat,
                linear-gradient(135deg, rgba(255,128,171,0.1) 0%, rgba(244,143,177,0.05) 100%);
  }

  .fitness-form {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    padding: 32px;
    width: 100%;
    max-width: 450px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(33, 150, 243, 0.1);
    backdrop-filter: blur(8px);
  }

  .fitness-form h1 {
    color: var(--gray-900);
    margin-bottom: 28px;
    font-size: 1.75rem;
    font-weight: 600;
    text-align: center;
    position: relative;
    padding-bottom: 16px;
  }

  /* Small inline spinner used for loading state on Edit buttons */
  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid rgba(0,0,0,0.15);
    border-top-color: rgba(0,0,0,0.45);
    border-radius: 50%;
    display: inline-block;
    vertical-align: middle;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  

  .activity-icons {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-bottom: 24px;
  }

  .activity-icon {
    width: 48px;
    height: 48px;
    padding: 12px;
    border-radius: 12px;
    background: var(--gray-100);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .activity-icon:hover {
    background: var(--primary-dark);
  }

  .activity-icon svg {
    width: 100%;
    height: 100%;
    fill: var(--gray-700);
  }

  .activity-icon:hover svg {
    fill: white;
  }

  .fitness-form h1::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 4px;
    background: var(--primary);
    border-radius: 2px;
  }
  
  .activity-icon {
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .activity-icon::after {
    content: attr(title);
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.75rem;
    color: var(--gray-700);
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .activity-icon:hover::after {
    opacity: 1;
  }

  .activity-icon.selected {
    background: var(--primary);
  }

  .activity-icon.selected svg {
    fill: white;
  }

  .activity-icons {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-bottom: 24px;
  }

  .activity-icon {
    width: 48px;
    height: 48px;
    padding: 12px;
    border-radius: 12px;
    background: var(--gray-100);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .activity-icon svg {
    width: 24px;
    height: 24px;
    fill: var(--primary);
  }

  .form-group {
    margin-bottom: 24px;
    position: relative;
  }

  .form-group label {
    display: block;
    color: var(--gray-700);
    margin-bottom: 8px;
    font-size: 0.95rem;
    font-weight: 500;
  }

  .form-group input {
    width: 80%;
    padding: 12px 16px;
    border: 2px solid var(--gray-400);
    border-radius: 10px;
    font-size: 1rem;
    transition: all 0.2s ease;
    background: var(--gray-100);
  }

  .form-group input:hover {
    border-color: var(--primary);
  }

  .form-group input:focus {
    outline: none;
    border-color: var(--primary);
    background: white;
    box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.1);
  }

  .input-hint {
    font-size: 0.85rem;
    color: var(--gray-700);
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .input-hint::before {
    content: "üí°";
  }

  .submit-button {
    width: 100%;
    padding: 14px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-top: 8px;
    position: relative;
    overflow: hidden;
  }

  .submit-button::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(rgba(255,255,255,0.2), transparent);
    opacity: 0;
    transition: opacity 0.2s;
  }

  .submit-button:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
  }

  .submit-button:hover::after {
    opacity: 1;
  }

  .submit-button:active {
    transform: translateY(1px);
  }

  .warning-logger {
    position: fixed;
    top: 24px;
    right: 24px;
    min-width: 320px;
    max-width: 400px;
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
  }

  .warning-message {
    padding: 16px;
    border-radius: 12px;
    font-size: 0.95rem;
    font-weight: 500;
    background: rgba(255, 193, 7, 0.15);
    color: #FF6F00;
    border: 1px solid rgba(255, 193, 7, 0.3);
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 12px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(8px);
    white-space: pre-line;
  }

  .warning-message.critical {
    background: rgba(244, 67, 54, 0.95);
    color: white;
    border-color: rgba(198, 40, 40, 0.3);
  }

  .warning-icon {
    font-size: 1.5rem;
    line-height: 1;
  }

  .warning-content {
    flex: 1;
  }

  .warning-close {
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    padding: 4px;
    opacity: 0.7;
    transition: opacity 0.2s;
    font-size: 1.2rem;
    line-height: 1;
  }

  .warning-close:hover {
    opacity: 1;
  }

  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes fadeOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }

  .warning-message.fade-out {
    animation: fadeOut 0.3s ease-in forwards;
  }

  /* Tab Styling */
  .auth-tabs {
    display: flex;
    gap: 0;
    margin-bottom: 24px;
    border-bottom: 2px solid var(--border-color, #ddd);
  }

  .auth-tabs button {
    flex: 1;
    padding: 12px 16px;
    border: none;
    background: transparent;
    color: var(--text-color, #666);
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
    margin-bottom: -2px;
  }

  .auth-tabs button:hover {
    color: var(--primary, #007bff);
    background: rgba(0, 123, 255, 0.05);
  }

  .auth-tabs button.active {
    color: var(--primary, #007bff);
    border-bottom-color: var(--primary, #007bff);
    font-weight: 600;
  }
</style>

<main class="main">
  <div class="fitness-form">
    <h1>Home-Based Ladies Tracker</h1>


    <ng-container *ngIf="!currentUser; else signedIn">
      <div class="auth-tabs">
        <button [class.active]="activeTab === 'user'" (click)="activeTab = 'user'" type="button">User</button>
        <button [class.active]="activeTab === 'admin'" (click)="activeTab = 'admin'" type="button">Admin</button>
      </div>

      <!-- User Sign Up / Sign In Panel -->
      <div *ngIf="activeTab === 'user'">
        <div class="form-group">
          <label for="authEmail">Email</label>
          <input id="authEmail" name="authEmail" type="email" [(ngModel)]="authEmail" placeholder="you@example.com" />
        </div>
        <div class="form-group">
          <label for="authPassword">Password</label>
          <input id="authPassword" name="authPassword" type="password" [(ngModel)]="authPassword" placeholder="password" />
        </div>
        <div class="form-group">
          <label for="display">Display name (optional)</label>
          <input id="display" name="display" type="text" [(ngModel)]="authDisplayName" placeholder="Jane" />
        </div>
        <div class="form-group">
          <label for="age">Age <span style="color:red;">*</span></label>
          <input id="age" name="age" type="number" [(ngModel)]="authAge" placeholder="e.g. 34" min="1" max="120" required />
          <div class="input-hint">We use age to estimate your HRmax (220 ‚àí age) to warn about unsafe heart rates.</div>
        </div>
        <div style="display:flex; gap:8px;">
          <button class="submit-button" (click)="signUp()" type="button">Sign up</button>
          <button class="submit-button" (click)="signIn()" type="button">Sign in</button>
        </div>
      </div>

      <!-- Admin Sign In Panel -->
      <div *ngIf="activeTab === 'admin'">
        <div class="form-group">
          <label for="adminEmail">Admin email</label>
          <input id="adminEmail" name="adminEmail" type="email" [(ngModel)]="adminEmail" placeholder="admin@example.com" />
        </div>
        <div class="form-group">
          <label for="adminPassword">Admin password</label>
          <input id="adminPassword" name="adminPassword" type="password" [(ngModel)]="adminPassword" placeholder="password" />
        </div>
        <div style="display:flex; gap:8px;">
          <button class="submit-button" (click)="signInAdmin()" type="button">Sign in as Admin</button>
        </div>
        <div class="input-hint">Static admin credentials: <strong>admin</strong> / <strong>admin1234</strong></div>
        <div *ngIf="showDevAdmin" class="input-hint">Dev admin (alternate): {{ adminDevEmail }} / (use the Admin login above)</div>
      </div>

      <!-- Temporary empty Admin landing page (shown immediately after admin sign-in) -->
      <div *ngIf="isAdmin && showAdminEmptyPage" style="margin-top:18px; padding:24px; border-radius:12px; background:rgba(0,0,0,0.03); text-align:center;">
        <h2>Admin Page</h2>
        <p>This is a temporary empty admin landing page.</p>
        <div style="display:flex; gap:8px; justify-content:center; margin-top:12px;">
          <button class="submit-button" (click)="openAdminDashboard()" type="button">Open Admin Dashboard</button>
          <button class="submit-button" (click)="signOut()" type="button">Sign out</button>
        </div>
      </div>

      <!-- Full Admin dashboard (open from the temporary landing page) -->
      <div *ngIf="isAdmin && showAdminDashboard" style="margin-top:18px; padding:24px; border-radius:12px; background:rgba(0,0,0,0.03);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
          <h2 style="margin:0">Admin Dashboard</h2>
          <div style="display:flex; gap:8px;">
            <button class="submit-button" (click)="loadUsersForAdmin()" type="button">Refresh users</button>
            <button class="submit-button" (click)="loadAllSessions()" type="button">View All Sessions</button>
            <button class="submit-button" (click)="showAdminDashboard = false; showAdminEmptyPage = true;" type="button">Close</button>
            <button class="submit-button" (click)="signOut()" type="button">Sign out</button>
          </div>
        </div>

        <div style="display:flex; gap:24px; align-items:flex-start;">
          <div style="flex:1; min-width:240px;">
            <h3>Users</h3>
            <div *ngIf="!usersList || usersList.length === 0">No users found. Click "Refresh users".</div>
            <ul>
              <li *ngFor="let u of usersList" style="margin-bottom:8px;">
                <div style="display:flex; justify-content:space-between; gap:8px; align-items:center;">
                  <div>
                    <strong>{{ u.email }}</strong>
                    <div class="input-hint">id: {{ u.id }} {{ u.isAdmin ? '‚Ä¢ admin' : '' }}</div>
                  </div>
                      <div style="display:flex; gap:8px;">
                      <button class="submit-button" (click)="viewSessionsFor(u.id)" type="button">View Sessions</button>
                    </div>
                  </div>

                  <!-- Inline per-user sessions panel (collapsible) -->
                  <div *ngIf="sessionsOwner === u.id" style="margin-top:8px; padding:8px; background:#fff; border-radius:6px; border:1px solid #eee;">
                    <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
                      <strong style="margin:0">Sessions</strong>
                      <div style="display:flex; gap:8px;">
                        <button class="submit-button" (click)="collapseSessions()" type="button" style="font-size:0.85rem;">Close</button>
                      </div>
                    </div>
                    <div *ngIf="viewedSessions.length === 0" class="input-hint" style="margin-top:8px">No sessions for this user.</div>
                    <ul style="list-style:none; padding:0; margin-top:8px;">
                      <li *ngFor="let s of viewedSessions" style="margin-bottom:8px; padding:8px; background:white; border-radius:6px; border:1px solid #ddd;">
                        <!-- Header / Summary Row (always visible) -->
                        <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
                          <div style="flex:1; cursor:pointer;" (click)="toggleSessionExpand(s.id)">
                            <strong>Week {{ s.week }} ‚Ä¢ Session {{ s.sessionNumber || s.session }} ‚Ä¢ Set {{ s.setNumber || s.set }}</strong>
                            <div class="input-hint">Intensity: {{ s.intensity }} ‚Ä¢ Heart Rate: {{ s.heartRate }} bpm</div>
                            <div class="input-hint">Saved: {{ s.createdAt | date:'short' }}</div>
                          </div>
                          <button class="submit-button" (click)="toggleSessionExpand(s.id)" type="button" style="font-size:0.85rem; white-space:nowrap;">{{ expandedSessionId === s.id ? '‚ñº' : '‚ñ∂' }}</button>
                        </div>
                        
                        <!-- Expanded Details (Edit/Delete/Notes) -->
                        <div *ngIf="expandedSessionId === s.id" style="margin-top:12px; padding-top:12px; border-top:1px solid #eee;">
                          <!-- Display mode -->
                          <div *ngIf="editingSessionId !== s.id">
                            <div style="margin-bottom:12px;">
                              <strong style="font-size:0.9rem;">Actions:</strong>
                              <div style="display:flex; gap:6px; margin-top:6px;">
                                <button class="submit-button" (click)="startEditSession(s)" type="button" style="font-size:0.85rem;" [disabled]="loadingSessionId === s.id || savingSessionId === s.id || deletingSessionId === s.id">
                                  <span *ngIf="loadingSessionId === s.id || savingSessionId === s.id" class="spinner" aria-hidden="true"></span>
                                  <span *ngIf="loadingSessionId !== s.id && savingSessionId !== s.id">Edit</span>
                                </button>
                                <button class="submit-button" (click)="deleteSessionForUser(s.id)" type="button" style="font-size:0.85rem; background:#f8d7da; color:#6b0000;" [disabled]="loadingSessionId === s.id || editingSessionId === s.id || savingSessionId === s.id || deletingSessionId === s.id">Delete</button>
                              </div>
                            </div>
                          </div>
                          <!-- Edit mode -->
                          <div *ngIf="editingSessionId === s.id">
                            <strong style="display:block; margin-bottom:8px; font-size:0.9rem;">Edit Session</strong>
                            <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:12px;">
                              <div style="flex:1; min-width:100px;">
                                <label style="display:block; font-size:0.8rem; margin-bottom:3px;">Intensity</label>
                                <input type="number" [(ngModel)]="editedSession.intensity" min="1" max="20" style="width:100%; padding:4px; border:1px solid #ddd; border-radius:4px; font-size:0.85rem;" />
                              </div>
                              <div style="flex:1; min-width:100px;">
                                <label style="display:block; font-size:0.8rem; margin-bottom:3px;">Heart Rate</label>
                                <input type="number" [(ngModel)]="editedSession.heartRate" min="30" max="220" style="width:100%; padding:4px; border:1px solid #ddd; border-radius:4px; font-size:0.85rem;" />
                              </div>
                              <div style="flex:1; min-width:120px;">
                                <label style="display:block; font-size:0.8rem; margin-bottom:3px;">Notes</label>
                                <input type="text" [(ngModel)]="editedSession.notes" placeholder="Notes" style="width:100%; padding:4px; border:1px solid #ddd; border-radius:4px; font-size:0.85rem;" />
                              </div>
                            </div>
                            <div style="display:flex; gap:6px;">
                              <button class="submit-button" (click)="saveEditedSession(s.id)" type="button" style="font-size:0.85rem;" [disabled]="savingSessionId === s.id">
                                <span *ngIf="savingSessionId === s.id" class="spinner" aria-hidden="true"></span>
                                <span *ngIf="savingSessionId !== s.id">Save</span>
                              </button>
                              <button class="submit-button" (click)="cancelEditSession()" type="button" style="font-size:0.85rem; background:#bbb;">Cancel</button>
                            </div>
                          </div>
                        </div>
                      </li>
                    </ul>
                    <div style="margin-top:8px; display:flex; gap:8px;">
                      <button class="submit-button" (click)="toggleNewSessionForm()" type="button">{{ showNewSessionForm ? 'Cancel' : 'Add Session' }}</button>
                    </div>
                    <div *ngIf="showNewSessionForm" style="margin-top:8px; padding:8px; border-radius:6px; background:#fafafa; border:1px solid #eee;">
                      <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
                        <input type="number" [(ngModel)]="newSession.week" min="1" placeholder="Week" style="width:80px; padding:6px;" />
                        <input type="number" [(ngModel)]="newSession.sessionNumber" min="1" placeholder="Session" style="width:80px; padding:6px;" />
                        <input type="number" [(ngModel)]="newSession.setNumber" min="1" placeholder="Set" style="width:80px; padding:6px;" />
                        <input type="number" [(ngModel)]="newSession.intensity" min="1" max="20" placeholder="Intensity" style="width:100px; padding:6px;" />
                        <input type="number" [(ngModel)]="newSession.heartRate" min="30" max="220" placeholder="HR" style="width:100px; padding:6px;" />
                        <input type="text" [(ngModel)]="newSession.notes" placeholder="Notes" style="flex:1; padding:6px;" />
                        <button class="submit-button" (click)="createSessionForUser()" type="button" [disabled]="savingSessionId === 'new'"> <span *ngIf="savingSessionId === 'new'" class="spinner"></span> Create</button>
                      </div>
                    </div>
                  </div>
                </li>
            </ul>
          </div>

          <div style="flex:2; min-width:320px;">
            <div *ngIf="viewedAllSessions && viewedAllSessions.length > 0" style="margin-top:14px;">
              <h3>All Sessions</h3>
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                <div>
                  <button class="submit-button" (click)="prevAllSessionsPage()" [disabled]="allSessionsCursorStack.length === 0" type="button">Prev</button>
                  <button class="submit-button" (click)="nextAllSessionsPage()" [disabled]="!allSessionsHasMore" type="button">Next</button>
                </div>
                <div class="input-hint">Page: {{ allSessionsCursorStack.length + 1 }}</div>
              </div>

              <ul>
                <li *ngFor="let s of viewedAllSessions">
                  <strong>{{ s.userEmail }}</strong> ‚Äî <strong>Week {{ s.week }}</strong> session: {{ s.sessionNumber || s.session }} set: {{ s.setNumber || s.set }} ‚Äî intensity: {{ s.intensity }} ‚Äî HR: {{ s.heartRate }}
                  <div class="input-hint">Notes: {{ s.notes }} ‚Äî saved: {{ s.createdAt }}</div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    

    <ng-template #signedIn>
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
        <div>
          <strong>Signed in:</strong> {{ currentUser?.email }}
        </div>
        <div>
          <button class="submit-button" (click)="signOut()" type="button">Sign out</button>
        </div>
      </div>

      <!-- Regular User: Training Form -->
      <ng-container *ngIf="!isAdmin">
        <!-- Admin request -->
        <!-- <div style="margin-bottom:12px;">
          <button class="submit-button" (click)="requestAdmin()" type="button" [disabled]="adminRequestSent">Request Admin Access</button>
          <div *ngIf="adminRequestSent" class="input-hint">Admin request submitted ‚Äî an administrator will review it.</div>
        </div> -->

        <div class="form-group">
          <label for="week">Select Week</label>
          <select id="week" [(ngModel)]="selectedWeek" name="week" (change)="onWeekChange()">
            <option *ngFor="let w of getWeekRange()" [ngValue]="w" [disabled]="isWeekFullySubmitted(w)">Week {{ w }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="session">Select Session</label>
          <select id="session" name="session" [(ngModel)]="selectedSession" (change)="onSessionChange()">
            <option *ngFor="let s of getSetRange(getSessionsForWeek(selectedWeek))" [ngValue]="s">Session {{ s }}</option>
          </select>
          <div class="input-hint">Sessions this week: {{ getSessionsForWeek(selectedWeek) }}</div>
        </div>

        <div class="form-group">
          <label for="set">Select Set</label>
          <select id="set" name="set" [(ngModel)]="selectedSet">
            <option *ngFor="let s of getSetRange(getSetsForWeek(selectedWeek))" [ngValue]="s" [disabled]="isSetSubmitted(selectedWeek, s, selectedSession)">Set {{ s }} <span *ngIf="isSetSubmitted(selectedWeek, s, selectedSession)">‚Äî Saved</span></option>
          </select>
          <div class="input-hint">Sets per session: {{ getSetsForWeek(selectedWeek) }}</div>
        </div>

        <div class="form-group">
          <label for="intensity">Intensity (RPE)</label>
          <select id="intensity" name="intensity" [(ngModel)]="userData.intensity">
            <option [ngValue]="6">6</option>
            <option [ngValue]="7">7</option>
            <option [ngValue]="8">8</option>
            <option [ngValue]="9">9</option>
            <option [ngValue]="10">10</option>
            <option [ngValue]="11">11</option>
            <option [ngValue]="12">12</option>
            <option [ngValue]="13">13</option>
            <option [ngValue]="14">14</option>
            <option [ngValue]="15">15</option>
          <option [ngValue]="16">16</option>
          <option [ngValue]="17">17</option>
          <option [ngValue]="18">18</option>
          <option [ngValue]="19">19</option>
          <option [ngValue]="20">20</option>
        </select>
      </div>

      <div class="form-group">
        <label for="hr">Heart Rate (% HRmax)</label>
        <input id="hr" type="number" name="heartRate" [(ngModel)]="userData.heartRate" min="40" max="220" />
      </div>

      <div style="display:flex; gap:8px;">
        <button class="submit-button" (click)="saveSession()" type="button" [disabled]="isSetSubmitted(selectedWeek, selectedSet, selectedSession)">Save Session</button>
        <button class="submit-button" (click)="onSubmit()" type="button">Quick Validate</button>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
        <label style="display:flex; align-items:center; gap:8px;">
          <input type="checkbox" [(ngModel)]="saveAllSets" /> Save all sets for this session
        </label>
        <div class="input-hint">When checked, the app will record one session document per set for the selected week.</div>
      </div>
      </ng-container>

      <!-- Admin Dashboard: Only for admins -->
      <ng-container *ngIf="isAdmin">
        <div style="margin-top:24px; padding:20px; border-radius:12px; background:rgba(0,0,0,0.03);">
          <h2>Admin Dashboard</h2>
          
          <div style="display:flex; gap:8px; margin-bottom:16px;">
            <button class="submit-button" (click)="loadUsersForAdmin()" type="button">Refresh Users</button>
            <button class="submit-button" (click)="openAdminDashboard()" type="button">Load All Sessions</button>
            <button class="submit-button" (click)="exportToExcel()" type="button" style="background:#4CAF50;">üì• Export to Excel</button>
            <button class="submit-button" (click)="connectToGoogleDrive()" type="button" style="background:#1F88E5;" *ngIf="!isGoogleDriveConnected">‚òÅÔ∏è Connect Drive</button>
            <button class="submit-button" (click)="disconnectFromGoogleDrive()" type="button" style="background:#EA4335;" *ngIf="isGoogleDriveConnected">‚úì Drive Connected</button>
          </div>

          <!-- Users List -->
          <div style="margin-bottom:24px;">
            <h3>All Users</h3>
            <div *ngIf="!usersList || usersList.length === 0" class="input-hint">No users found. Click "Refresh Users".</div>
            <ul style="list-style:none; padding:0; display:grid; grid-template-columns:repeat(auto-fill, minmax(300px, 1fr)); gap:12px;">
              <li *ngFor="let u of usersList" style="padding:8px; background:white; border-radius:6px; border:1px solid #ddd;">
                <div style="display:flex; justify-content:space-between; align-items:start; gap:8px;">
                  <div style="flex:1;">
                    <strong>{{ u.email }}</strong>
                    <div class="input-hint" style="margin-top:4px;">
                      Age: {{ u.age || 'N/A' }} {{ u.isAdmin ? '‚Ä¢ Admin' : '' }}
                    </div>
                    <div class="input-hint" style="margin-top:2px;">Joined: {{ u.createdAt | date:'short' }}</div>
                  </div>
                  <div style="display:flex; flex-direction:column; gap:4px;">
                    <button class="submit-button" (click)="viewSessionsFor(u.id)" type="button" style="font-size:0.85rem;">View Sessions</button>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <!-- Sessions View -->
          <div style="margin-top:24px;">
              <!-- User's Sessions -->
              <div *ngIf="sessionsOwner">
                <h3>Sessions for {{ sessionsOwner }}</h3>
                <div *ngIf="viewedSessions.length === 0" class="input-hint">No sessions for this user.</div>
                <ul style="list-style:none; padding:0;">
                  <li *ngFor="let s of viewedSessions" style="margin-bottom:8px; padding:8px; background:white; border-radius:6px; border:1px solid #ddd;">
                    <strong>Week {{ s.week }} ‚Ä¢ Session {{ s.sessionNumber || s.session }} ‚Ä¢ Set {{ s.setNumber || s.set }}</strong>
                    <div class="input-hint">Intensity: {{ s.intensity }} ‚Ä¢ Heart Rate: {{ s.heartRate }} bpm</div>
                    <div class="input-hint">Saved: {{ s.createdAt | date:'short' }}</div>
                  </li>
                </ul>
                <div style="margin-top:8px; display:flex; gap:8px;">
                  <button class="submit-button" (click)="toggleNewSessionForm()" type="button">{{ showNewSessionForm ? 'Cancel' : 'Add Session' }}</button>
                </div>
                <div *ngIf="showNewSessionForm" style="margin-top:8px; padding:8px; border-radius:6px; background:#fafafa; border:1px solid #eee;">
                  <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
                    <input type="number" [(ngModel)]="newSession.week" min="1" placeholder="Week" style="width:80px; padding:6px;" />
                    <input type="number" [(ngModel)]="newSession.sessionNumber" min="1" placeholder="Session" style="width:80px; padding:6px;" />
                    <input type="number" [(ngModel)]="newSession.setNumber" min="1" placeholder="Set" style="width:80px; padding:6px;" />
                    <input type="number" [(ngModel)]="newSession.intensity" min="1" max="20" placeholder="Intensity" style="width:100px; padding:6px;" />
                    <input type="number" [(ngModel)]="newSession.heartRate" min="30" max="220" placeholder="HR" style="width:100px; padding:6px;" />
                    <input type="text" [(ngModel)]="newSession.notes" placeholder="Notes" style="flex:1; padding:6px;" />
                    <button class="submit-button" (click)="createSessionForUser()" type="button" [disabled]="savingSessionId === 'new'"> <span *ngIf="savingSessionId === 'new'" class="spinner"></span> Create</button>
                  </div>
                </div>
              </div>

              <!-- All Sessions (Paginated) -->
              <div *ngIf="viewedAllSessions && viewedAllSessions.length > 0" style="margin-top:24px;">
                <h3>All Sessions (Paginated)</h3>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                  <div style="display:flex; gap:8px;">
                    <button class="submit-button" (click)="prevAllSessionsPage()" [disabled]="allSessionsCursorStack.length === 0" type="button">‚Üê Prev</button>
                    <button class="submit-button" (click)="nextAllSessionsPage()" [disabled]="!allSessionsHasMore" type="button">Next ‚Üí</button>
                  </div>
                  <div class="input-hint">Page {{ allSessionsCursorStack.length + 1 }}</div>
                </div>
                <ul style="list-style:none; padding:0;">
                  <li *ngFor="let s of viewedAllSessions" style="margin-bottom:8px; padding:8px; background:white; border-radius:6px; border:1px solid #ddd;">
                    <div><strong>{{ s.userEmail }}</strong> ‚Ä¢ Week {{ s.week }} ‚Ä¢ Session {{ s.sessionNumber || s.session }} ‚Ä¢ Set {{ s.setNumber || s.set }}</div>
                    <div class="input-hint">Intensity: {{ s.intensity }} ‚Ä¢ Heart Rate: {{ s.heartRate }} bpm</div>
                    <div class="input-hint">Saved: {{ s.createdAt | date:'short' }}</div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
      </ng-container>
    </ng-template>
  </div>
</main>

<!-- Warning Logger -->
<div class="warning-logger">
  <div *ngFor="let log of warningLogs(); let i = index" [class]="'warning-message' + (log.type === 'critical' ? ' critical' : '')">
    <span class="warning-icon">‚ö†Ô∏è</span>
    <div class="warning-content">
      {{ log.message }}
    </div>
    <button 
      class="warning-close" 
      (click)="removeWarningLog(log.id)"
      title="Dismiss"
    >√ó</button>
  </div>
</div>